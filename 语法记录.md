# 修改原表：
1. 更新旧数据值
    UPDATE gameRecord
SET countValidBetWay = 'byBet'
WHERE countValidBetWay = '按投注';
 2. 修改字段类型 + 添加字段：
 ALTER TABLE gameRecord
MODIFY COLUMN countValidBetWay ENUM('byBet', 'byWinLose') NOT NULL DEFAULT 'byBet',
ADD COLUMN gameResult DECIMAL(10, 2) DEFAULT 0 COMMENT '游戏输赢金额，正为赢，负为输'; 
3. 删除旧触发器（改名字为你原来触发器名）：
   DROP TRIGGER IF EXISTS sync_valid_bet_amount;
4. 创建新触发器：
DELIMITER $$

CREATE TRIGGER sync_valid_bet_amount
BEFORE INSERT ON gameRecord
FOR EACH ROW
BEGIN
    IF NEW.countValidBetWay = 'byBet' THEN
        SET NEW.validBetAmount = NEW.betAmount;
    ELSEIF NEW.countValidBetWay = 'byWinLose' THEN
        SET NEW.validBetAmount = ABS(NEW.gameResult);
    ELSE
        SET NEW.validBetAmount = 0;
    END IF;
END$$

DELIMITER ;
 5. 添加 gameResult 字段
    ALTER TABLE gameRecord
ADD COLUMN gameResult DECIMAL(10, 2) DEFAULT 0 COMMENT '游戏输赢金额，正为赢，负为输';

# 删除触发器
 1. 查看当前有哪些触发器：
  SHOW TRIGGERS LIKE 'gameRecord';
  2. 删除旧触发器（改名字为你原来触发器名）：
   DROP TRIGGER IF EXISTS sync_valid_bet_amount;

# 添加新的触发器
 1. 效果是：
	•	如果 countValidBetWay = 'byBet'，则 validBetAmount = betAmount
	•	如果 countValidBetWay = 'byWinLose'，则 validBetAmount = ABS(gameResult)
 DELIMITER $$

CREATE TRIGGER sync_valid_bet_amount
BEFORE INSERT ON gameRecord
FOR EACH ROW
BEGIN
    IF NEW.countValidBetWay = 'byBet' THEN
        SET NEW.validBetAmount = NEW.betAmount;
    ELSEIF NEW.countValidBetWay = 'byWinLose' THEN
        SET NEW.validBetAmount = ABS(NEW.gameResult);
    ELSE
        SET NEW.validBetAmount = 0;
    END IF;
END$$

DELIMITER ;



# 插入新数据
INSERT INTO
    `表名` (
        `字段`,
        `字段`,
        `字段`
    )
VALUES (对应内容, 字段内容, 字段内容)

# 删 （TABLE 和 TRIGGER 在 MySQL 中都属于关键字）
    DROP TRIGGER IF EXISTS sync_valid_bet_amount;
(保留字)（keyword）语法的语句片段   自定义的名字(非关键字)

# 改表 
改表开头：ALTER TABLE 表名
ALTER TABLE 表名
MODIFY COLUMN 字段 ENUM('byBet', 'byWinLose') NOT NULL DEFAULT 'byBet',
ADD COLUMN 新需要的字段 INT(10) DEFAULT 0 COMMENT '游戏输赢金额，正为赢，负为输';
- 扩大字段
  ALTER TABLE gameRecord
MODIFY COLUMN countValidBetWay VARCHAR(20);
- 改字段名称
ALTER TABLE gameRecord
CHANGE validBetStrategy countValidBetWay ENUM('byBet', 'byWinLose') NOT NULL DEFAULT 'byBet' COMMENT '计算有效投注方式';

# 更新
UPDATE gameRecord
SET countValidBetWay = CASE
  WHEN countValidBetWay = '按投注' THEN 'byBet'
  WHEN countValidBetWay = '按输赢' THEN 'byWinLose'
  ELSE NULL
END;

# 查询 
SELECT * FROM `表名`
WHERE `字段` = `字段内容`

# 计算团队业绩 （仅统计团队业绩，不含直属）
- 使用 递归查询 获取所有下级，再从中排除直属下级
WITH RECURSIVE all_subs AS (
  SELECT userId
  FROM agencyRelation
  WHERE inviteId = ? -- 当前用户ID

  UNION ALL

  SELECT ar.userId
  FROM agencyRelation ar
  JOIN all_subs s ON ar.inviteId = s.userId
)

SELECT gameType, SUM(betAmount) AS teamAmount
FROM gameRecord
WHERE userId IN (
  SELECT userId FROM all_subs
  WHERE userId NOT IN (
    SELECT userId FROM agencyRelation WHERE inviteId = ?
  )
)
GROUP BY gameType;

   