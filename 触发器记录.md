# 查询 TRIGGERS
SHOW TRIGGERS WHERE `Table` = 'gameRecord';

# 删除 TRIGGERS
DROP TRIGGER IF EXISTS update_valid_bet_amount;
DROP TRIGGER IF EXISTS Trigger名字;


1. 插入时根据 gameVendor 自动设置 countValidBetWay
    •	根据 gameVendor 字段来自动设置 countValidBetWay 字段
   - 当插入或更新 gameRecord 表时，根据 gameVendor 字段来自动设置 countValidBetWay 字段：
	•	如果 gameVendor = 'Spribe' → countValidBetWay = 'byWinLose'
	•	其他厂商 → countValidBetWay = 'byBet'
- 插入countValidBetWay
DELIMITER $$

CREATE TRIGGER set_valid_bet_way_by_vendor_on_insert
BEFORE INSERT ON gameRecord
FOR EACH ROW
BEGIN
  IF NEW.gameVendor = 'Spribe' THEN
    SET NEW.countValidBetWay = 'byWinLose';
  ELSE
    SET NEW.countValidBetWay = 'byBet';
  END IF;
END$$

DELIMITER ;
- 更新时根据 gameVendor 自动更新 countValidBetWay
    •	当更新
DELIMITER $$

CREATE TRIGGER set_valid_bet_way_by_vendor
BEFORE UPDATE ON gameRecord
FOR EACH ROW
BEGIN
  IF NEW.gameVendor = 'Spribe' THEN
    SET NEW.countValidBetWay = 'byWinLose';
  ELSE
    SET NEW.countValidBetWay = 'byBet';
  END IF;
END$$

DELIMITER ;




1. 插入时根据策略自动计算 validBetAmount
    - 更新或插入 betAmount 或 gameResult 或 countValidBetWay 时，自动同步更新 validBetAmount 字段，规则如下：
	•	如果 countValidBetWay = 'byBet'，则 validBetAmount = betAmount
	•	如果 countValidBetWay = 'byWinLose'，则 validBetAmount = ABS(gameResult)

- 当插入
DELIMITER $$

CREATE TRIGGER set_valid_bet_amount_on_update
BEFORE INSERT ON gameRecord
FOR EACH ROW
BEGIN
  IF NEW.countValidBetWay = 'byBet' THEN
    SET NEW.validBetAmount = NEW.betAmount;
  ELSEIF NEW.countValidBetWay = 'byWinLose' THEN
    SET NEW.validBetAmount = ABS(NEW.gameResult);
  ELSE
    SET NEW.validBetAmount = 0;
  END IF;
END$$

DELIMITER ;


- 更新 betAmount 或 gameResult 或 countValidBetWay 时，自动同步更新 validBetAmount 字段，规则如下：
	•	如果 countValidBetWay = 'byBet'，则 validBetAmount = betAmount
	•	如果 countValidBetWay = 'byWinLose'，则 validBetAmount = ABS(gameResult)
DELIMITER $$

CREATE TRIGGER set_valid_bet_amount_on_update
BEFORE UPDATE ON gameRecord
FOR EACH ROW
BEGIN
  IF NEW.countValidBetWay = 'byBet' THEN
    SET NEW.validBetAmount = NEW.betAmount;
  ELSEIF NEW.countValidBetWay = 'byWinLose' THEN
    SET NEW.validBetAmount = ABS(NEW.gameResult);
  ELSE
    SET NEW.validBetAmount = 0; -- 可选兜底逻辑
  END IF;
END$$

DELIMITER ;